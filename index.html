<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>McCoy.fish</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
      background-image: url('mccoyfishwallpaper.jpg');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      background-repeat: no-repeat;
      color: #d6d6d6;
    }

    header {
      text-align: center;
      padding-top: 40px;
    }

    header img {
      max-width: 160px;
      height: auto;
    }

    h1 {
      font-size: 3em;
      margin: 10px 0;
      color: #ccc;
    }

    main {
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .search-section {
      background-color: rgba(0, 20, 10, 0.75);
      border-radius: 15px;
      box-shadow: 0 0 20px #003300;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      margin-top: 20px;
    }

    .search-section h2 {
      text-align: center;
      font-size: 1.7em;
      color: #b8ffb3;
      margin-bottom: 20px;
    }

    .search-section input,
    .search-section select,
    .search-section button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: none;
      font-size: 1em;
      background-color: #294a38;
      color: #ddd;
    }

    .search-section button {
      background-color: #3f6d4e;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .search-section button:hover {
      background-color: #51996b;
    }

    footer {
      text-align: center;
      padding: 30px 0 20px 0;
      font-size: 0.9em;
      color: #ccc;
    }
  </style>
</head>
<body>
  <header>
    <img src="mccoyfishlogo.png" alt="McCoy Fish Logo" />
    <h1>McCoy.fish</h1>
  </header>

  <main>
    <section class="search-section">
      <h2>Search Water Data</h2>
<input type="text" id="location-input" placeholder="River, City, or State" />
<select id="radius-select">
  <option value="5">5 miles</option>
  <option value="10">10 miles</option>
  <option value="25">25 miles</option>
  <option value="50">50 miles</option>
  <option value="100">100 miles</option>
  <option value="250">250 miles</option>
</select>
<button onclick="revealSections()">Search</button>

    </section>

<section class="gage-section" id="chart-section" style="display:none; background-color: rgba(0, 20, 10, 0.75); border-radius: 15px; box-shadow: 0 0 20px #003300; padding: 30px; width: 90%; max-width: 600px; margin-top: 20px;">
  <h2 style="color: #b8ffb3; text-align: center;">Gage Height Chart</h2>
  <img id="usgs-chart-img" alt="USGS Gage Height Chart" style="width: 100%; height: auto;" />
</section>

    
  </main>

  <footer>
    Â© 2025 McCoy.fish. All rights reserved.
  </footer>

<script>
  async function revealSections() {
    const locationInput = document.getElementById("location-input").value;
    const radius = document.getElementById("radius-select").value;

    if (!locationInput) {
      alert("Please enter a location.");
      return;
    }

    // Fetch matching USGS gages from API
    const query = encodeURIComponent(locationInput);
    const url = `https://waterservices.usgs.gov/nwis/site/?format=rdb&siteType=ST&siteOutput=expanded&stateCd=all&outputDataTypeCd=iv&parameterCd=00065&siteName=${query}`;

    try {
      const response = await fetch(url);
      const text = await response.text();

      // Parse site numbers from the response
      const lines = text.split('\n');
      const dataLines = lines.filter(line => !line.startsWith('#') && !line.startsWith('agency_cd') && line.trim() !== '');

      if (dataLines.length === 0) {
        alert("No matching gages found.");
        return;
      }

      // Create a list of matching options if more than one
      if (dataLines.length > 1) {
        const options = dataLines.map(line => {
          const parts = line.split('\t');
          return {
            siteId: parts[1],
            name: parts[2]
          };
        });

        const choice = prompt(
          "Multiple gages found:\n\n" +
          options.map((opt, i) => `${i + 1}: ${opt.name} (${opt.siteId})`).join('\n') +
          "\n\nEnter the number of the one you want:"
        );

        const selected = options[parseInt(choice) - 1];
        if (!selected) {
          alert("Invalid selection.");
          return;
        }

        updateChart(selected.siteId);
      } else {
        const parts = dataLines[0].split('\t');
        const siteId = parts[1];
        updateChart(siteId);
      }
    } catch (error) {
      console.error("Error fetching gage data:", error);
      alert("Failed to fetch gage data.");
    }
  }

  function updateChart(siteId) {
    document.getElementById("chart-section").style.display = 'block';
    document.getElementById("usgs-chart-img").src =
      `https://waterdata.usgs.gov/nwisweb/graph?agency_cd=USGS&site_no=${siteId}&parm_cd=00065&period=7`;
  }
</script>


  
</body>
</html>
